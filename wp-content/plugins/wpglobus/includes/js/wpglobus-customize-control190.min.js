jQuery(document).ready(function(a){"use strict";var u={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,customizeSave:!1,selectorHtml:"",settingsSectionExpand:function(){a(document).triggerHandler("wpglobus_fields_settings_section_expand",[this,u])},init:function(e){u.selectorHtml=WPGlobusCustomize.selector_html,u.setTitle(),"false"!=WPGlobusCustomizeOptions.themeEnabled&&(a.each(WPGlobusCoreData.enabled_languages,function(e,t){u.languages[e]=t,u.length=e}),u.addLanguageSelector(),u.setControlInstances(),u.setFieldsSection(),u.attachListeners(),u.setTinymce())},updateTinymce:function(e){"tinymce"==WPGlobusCustomize.controlInstances[this.id].type&&(WPGlobusCustomize.controlInstances[this.id].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[this.id].setting,e.target.textContent,WPGlobusCoreData.language))},setTinymce:function(e){a(document).on("tinymce-editor-init",function(e,t){"object"==typeof u.controlInstances[t.id]&&(u.controlInstances[t.id].type="tinymce",a(t.iframeElement).addClass("wpglobus-customize-control").css({width:"99%"}),t.on("input",_.debounce(u.updateTinymce,300)))})},getSize:function(e){return void 0===e?_.size(u.controlInstances):"widget"==e?_.size(u.controlWidgets):null},setFieldsSection:function(){var o={},n=a(".wpglobus-fields_settings_control_box").data("section-template"),s="",l="",i="";a.each(WPGlobusCustomize.controlInstances,function(e,t){void 0===o[t.section]&&(o[t.section]={}),o[t.section][e]=t}),a.each(o,function(e,t){if(l="<ul>",a.each(t,function(e,t){i=t.userControl.enabled?" checked ":"",l+='<li id="'+t.fieldSettings.itemID+'">',l+='<input id="'+t.fieldSettings.cbID+'" data-control="'+e+'" class="wpglobus-customize-cb-control" type="checkbox"'+i+' /> <span class="wpglobus-cb-control-title">'+t.title+"</span>",l+="</li>"}),l+="</ul>",void 0===wp.customize.section(e))return!0;s=(s=(s=(s=n.replace("{{section_title}}",wp.customize.section(e).params.title)).replace(/{{section}}/g,e)).replace("{{section_id}}",'"'+e+'"')).replace("{{items}}",l),a(s).insertBefore(a("#"+WPGlobusCustomizeOptions.userControlSaveButton))}),a("#accordion-section-wpglobus_fields_settings_section").css({"margin-top":"15px"}),a(WPGlobusCustomizeOptions.helpButton).insertAfter(a("#accordion-section-wpglobus_fields_settings_section .customize-action")),a("#accordion-section-wpglobus_fields_settings_section .customize-section-description").addClass("hidden"),a(document).on("click","."+WPGlobusCustomizeOptions.userControlIconClass,function(e){var o=a(this).data("section");a(WPGlobusCustomizeOptions.userControlBoxSelector).each(function(e,t){o==a(t).data("section")?a(this).css({display:"block"}):a(this).css({display:"none"})}),wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:u.settingsSectionExpand})}),a(".wpglobus-customize-icon-help.customize-help-toggle").on("click",function(e){a("#accordion-section-wpglobus_fields_settings_section .customize-section-description").toggleClass("hidden")})},setUserControls:function(e,t){var o=t.controlSelector+" "+t.selector,n='<img class="'+WPGlobusCustomizeOptions.userControlIconClass+'" data-section="'+t.section+'" style="position:absolute;right:0px;cursor:pointer;" src="'+WPGlobusCustomizeOptions.userControlIcon+'" />';a(n).insertBefore(o),t.userControl.enabled||(1<a(o).length?a(o).each(function(e,t){a(t).removeClass(WPGlobusCustomize.controlClass)}):a(o).removeClass(WPGlobusCustomize.controlClass).val(t.setting))},ctrlMenuItemsCallback:function(e,t){},ctrlWidgetCallback:function(l,i){if(u.action=!1,void 0===u.controlWidgets[l].element){void 0===i&&(i=wp.customize.control.instance(l)),u.controlWidgets[l].element={},u.controlWidgets[l].control=i,u.controlWidgets[l].inWidgetTitle=i.container.find(".in-widget-title"),u.controlWidgets[l].parent=i.selector;var e=i.container.find("input[type=submit]");0!=e.length&&(e.css({display:"block"}),e.attr("data-widget",l),u.controlWidgets[l].submit=e,u.attachWidgetListeners(u.controlWidgets[l])),i.liveUpdateMode=!1,void 0===i.setting().title?u.controlWidgets[l].inWidgetTitle.text(""):u.controlWidgets[l].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(i.setting().title,WPGlobusCustomize.languageAdmin)),a.each(WPGlobusCustomize.elementSelector,function(e,n){var s=i.container.find(n);0!=s.length&&a.each(s,function(e,t){if(void 0===t.id||""==t.id)return!0;var o=a(s[e]);void 0===u.controlWidgets[l].element[t.id]&&(u.controlWidgets[l].element[t.id]={}),o.addClass("wpglobus-customize-widget-control"),o.attr("data-widget",l),u.controlWidgets[l].element[t.id].element=o,u.controlWidgets[l].element[t.id].setting=i.setting(),u.controlWidgets[l].element[t.id].selector=n,u.controlWidgets[l].element[t.id].value=t.defaultValue,o.val(WPGlobusCore.TextFilter(t.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),a(document).triggerHandler("wpglobus_customize_control_added_widget",[l])}},ctrlCallback:function(o,l,e){var n=!1;if(a.each(WPGlobusCustomize.disabledSections,function(e,t){if(o.section()==t)return!(n=!0)}),!n&&(a.each(WPGlobusCustomize.disabledSettingMask,function(e,t){if(0<=l.indexOf(t))return!(n=!0)}),!n)){var i=wp.customize.control.instance(l);if(0<=l.indexOf("widget"))return void 0===u.controlWidgets[l]&&(u.controlWidgets[l]={},u.action&&u.ctrlWidgetCallback(l,i)),u.controlWidgets[l].parent=i.selector,1!=a(i.selector).length?u.controlWidgets[l].observer=null:(u.controlWidgets[l].observer=new MutationObserver(function(e){e.forEach(function(e){"class"==e.attributeName&&-1!=e.target.className.indexOf("expanding")&&u.ctrlWidgetCallback(l)})}),u.controlWidgets[l].observer.observe(document.querySelector(u.controlWidgets[l].parent),{attributes:!0,childList:!0,characterData:!0})),!1;if(void 0===u.controlInstances[l]){var c=!0;a.each(WPGlobusCustomize.elementSelector,function(e,t){var s=i.container.find(t);if(0!=s.length){if("function"!=typeof i.setting)return!0;u.controlInstances[l]={},u.controlInstances[l].element=s,u.controlInstances[l].elementID=s.attr("id")?"#"+s.attr("id"):void 0,u.controlInstances[l].setting=i.setting(),u.controlInstances[l].settingType=typeof i.setting(),u.controlInstances[l].selector=t,u.controlInstances[l].controlSelector=i.selector,u.controlInstances[l].type="",u.controlInstances[l].section=i.section(),u.controlInstances[l].title=null,u.controlInstances[l].userControl=null,u.controlInstances[l].fieldSettings={},u.controlInstances[l].fieldSettings.itemID="item-wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(l),u.controlInstances[l].fieldSettings.cbID="wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(l),a.each(WPGlobusCustomize.setLinkBy,function(e,t){if(0<=l.indexOf(t)){if(u.controlInstances[l].type="link",""==u.controlInstances[l].setting&&(u.controlInstances[l].setting=s[0].defaultValue),WPGlobusCustomize.changeset_uuid){var o=wp.customize.control(l).setting();if(-1!==o.indexOf("|||")){var n=u.getTranslations(o);wp.customize.control(l).setting(n[WPGlobusCoreData.default_language]),a(WPGlobusCustomize.controlInstances[l].controlSelector+" "+WPGlobusCustomize.controlInstances[l].selector).val(n[WPGlobusCoreData.default_language])}}s.addClass("wpglobus-control-link")}}),""===u.controlInstances[l].type&&(u.controlInstances[l].type="textarea"==t?"textarea":"text"),"string"==u.controlInstances[l].settingType&&""!=u.controlInstances[l].setting&&s.val(WPGlobusCore.TextFilter(u.controlInstances[l].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),s.addClass("wpglobus-customize-control"),s.attr("data-wpglobus-customize-control",u.controlInstances[l].controlSelector.replace("#customize-control-","")),s.attr("data-wpglobus-customize-control-setting-type",u.controlInstances[l].settingType),"link"==u.controlInstances[l].type&&(u.controlInstances[l].setting=u.convertString(s[0].defaultValue)),u.controlInstances[l].title=i.params.label,null!==WPGlobusCustomizeOptions.userControl&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName]&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][l]&&"disable"==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][l]&&(c=!1),u.controlInstances[l].userControl={},u.controlInstances[l].userControl.enabled=c,u.setUserControls(l,u.controlInstances[l])}})}}},setControlInstances:function(){wp.customize.control.each(u.ctrlCallback)},setTitle:function(){a(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(e){if(void 0===e)return e;var o=[],t=WPGlobusCore.getTranslations(e),n=0,s=!0;return e==t[WPGlobusCoreData.default_language]?e:(a.each(t,function(e,t){o[n]=""==t?"null":(s=!1,t),n++}),s?"":o.join("|||"))},getTranslations:function(e){if(void 0===e)return e;var o={},n=e.split("|||");return a.each(WPGlobusCoreData.enabled_languages,function(e,t){o[t]=void 0===n[e]||"null"===n[e]?"":n[e]}),o},getString:function(e,o,n){if(void 0===e)return e;void 0===o&&(o=""),void 0===n&&(n=WPGlobusCoreData.language);var t=u.getTranslations(e),s=[],l=0,i=!0;return a.each(t,function(e,t){e==n?(o=o.trim(),s[l]=""==o?"null":o):s[l]=""==t?"null":t,e!=WPGlobusCoreData.default_language&&"null"!=s[l]&&(i=!1),l++}),s=i?s[0]:s.join("|||")},addLanguageSelector:function(){"dropdown"!=WPGlobusCustomize.selectorType?(a(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),a(".wpglobus-customize-selector").html(u.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),a(document).on("click",".wpglobus-customize-selector",function(e){u.index>u.length-1?u.index=0:u.index++,WPGlobusCoreData.language=u.languages[u.index],a(this).html(u.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),a(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),u.setControlsValue()})):u.addLanguageSelectorDropdown()},addLanguageSelectorDropdown:function(){a(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),a(".wpglobus-customize-selector").html(u.selectorHtml.replace("{{language}}",WPGlobusCoreData.language));var e=a(".wpglobus-customize-selector").offset(),t=e.top+46;t+="px;";var o=e.left+"px;",n=0,s='<ul class="wpglobus-customize-selector-dropdown" style="display:none;position:fixed;width:46px;border-left:1px solid #ddd;border-right:1px solid #ddd;background-color:#eee;margin:-1px 0 0;padding:0;top:'+t+"left:"+o+'">';a.each(WPGlobusCoreData.enabled_languages,function(e,t){s+='<li class="item" style="text-align:center;cursor:pointer;border-bottom:1px solid #ddd;margin:0;" data-language="'+t+'">',s+='<span class="value value-'+t+'" style="font-size:15px;">'+t+"</span>",s+="</li>"}),s+='<li class="item wpglobus-customize-item-settings" style="text-align:center;cursor:pointer;border-bottom:1px solid #ddd;margin:0;"><span style="padding-top:14px;" class="dashicons dashicons-admin-tools"></span></li>',s+="</ul>",a(".wpglobus-customize-selector").after(s),a(document).on("mouseenter",".wpglobus-customize-selector",function(e){a(".wpglobus-customize-selector-dropdown").css({display:"block"}),n=e.screenY}),a(document).on("mouseleave",".wpglobus-customize-selector",function(e){0!=n&&e.screenY-n<=0&&a(".wpglobus-customize-selector-dropdown").css({display:"none"})}),a(document).on("mouseleave",".wpglobus-customize-selector-dropdown",function(e){a(".wpglobus-customize-selector-dropdown").css({display:"none"})}),a(document).on("mouseenter",".wpglobus-customize-selector-dropdown .item",function(e){var t=a(this),o=t.data("language");t.addClass("active"),t.css({"background-color":"#fff"}),t.find(".value-"+o).css({"font-weight":"bold"})}),a(document).on("mouseleave",".wpglobus-customize-selector-dropdown .item",function(e){var t=a(this);t.removeClass("active"),t.css({"background-color":"#eee"}),a(this).find(".value").css({"font-weight":""})}),a(document).on("click",".wpglobus-customize-selector-dropdown .item",function(e){var t=a(this).data("language");void 0!==t&&t!=a(".wpglobus-customize-selector").data("language")&&u.languageChanged(t)}),a(document).on("click",".wpglobus-customize-item-settings",function(e){wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:u.settingsSectionExpand}),a(".wpglobus-customize-selector-dropdown").css({display:"none"})})},languageChanged:function(e){WPGlobusCoreData.language=e,a(".wpglobus-customize-selector").data("language",e),a(".wpglobus-customize-selector .current-language").text(e),a(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),u.setControlsValue()},setControlsValue:function(){a(".wpglobus-customize-control").each(function(e,t){var o=a(t),n=o.data("customize-setting-link");if(void 0!==WPGlobusCustomize.controlInstances[n]||(n=o.data("wpglobus-customize-control"),void 0!==WPGlobusCustomize.controlInstances[n]))if(o.hasClass("wpglobus-control-link")){var s=u.getTranslations(WPGlobusCustomize.controlInstances[n].setting);o.val(s[WPGlobusCoreData.language])}else if("object"==WPGlobusCustomize.controlInstances[n].settingType);else if("number"==WPGlobusCustomize.controlInstances[n].settingType);else{s=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[n].setting,WPGlobusCoreData.language,"RETURN_EMPTY");"tinymce"==WPGlobusCustomize.controlInstances[n].type&&tinymce.get(n).setContent(s,{format:"raw"}),o.val(WPGlobusCore.TextFilter(s,"RETURN_EMPTY"))}}),a(".wpglobus-customize-widget-control").each(function(e,t){var o=a(t),n=o.data("widget");if(void 0===o.attr("id"))return!0;o.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})},updateElements:function(s){void 0===s&&(s=!0),a.each(WPGlobusCustomize.controlInstances,function(e,t){if(!t.userControl.enabled)return!0;var o=wp.customize.control.instance(e);if("link"==t.type){var n=u.getTranslations(WPGlobusCustomize.controlInstances[e].setting);s?(o.setting.set(n[WPGlobusCoreData.language]),t.element.val(o.setting())):t.element.val(n[WPGlobusCoreData.language])}else if("tinymce"==t.type){n=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY");tinymce.get(e).setContent(n,{format:"raw"}),t.element.val(n)}else s?(o.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),t.element.val(o.setting())):t.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(e){"mouseenter"==e.type?a.each(u.controlWidgets[a(this).data("widget")].element,function(e,t){a("#"+e).val(t.value)}):"mouseleave"==e.type?u.widgetKeep||a.each(u.controlWidgets[a(this).data("widget")].element,function(e,t){a("#"+e).val(WPGlobusCore.TextFilter(t.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==e.type&&(u.widgetKeep=!0)},attachWidgetListeners:function(e){void 0!==e.submit[0].id&&a(document).on("mouseenter","#"+e.submit[0].id,u.onSubmitEvents).on("mouseleave","#"+e.submit[0].id,u.onSubmitEvents).on("click","#"+e.submit[0].id,u.onSubmitEvents)},attachListeners:function(){a(".wpglobus-customize-control").on("keyup",function(e){var t=a(this),o=t.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[o]&&(o=t.data("wpglobus-customize-control"),WPGlobusCustomize.controlInstances[o]),void 0===a(document).triggerHandler("wpglobus_customize_control_keyup",[t,o])&&("link"==WPGlobusCustomize.controlInstances[o].type?WPGlobusCustomize.controlInstances[o].setting=u.getString(WPGlobusCustomize.controlInstances[o].setting,t.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[o].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[o].setting,t.val(),WPGlobusCoreData.language))}),a(document).on("keyup",".wpglobus-customize-widget-control",function(e){var t=a(this),o=t.data("widget");void 0!==WPGlobusCustomize.controlWidgets[o]&&(WPGlobusCustomize.controlWidgets[o].element[t.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[o].element[t.attr("id")].value,t.val(),WPGlobusCoreData.language))}),a(document).on("mouseenter","#save",function(e){a.each(WPGlobusCustomize.controlInstances,function(e,t){if(t.userControl.enabled){var o=wp.customize.control.instance(e);"tinymce"==t.type&&tinymce.get(e).setContent(t.setting,{format:"raw"}),o.setting.set(t.setting),t.element.val(o.setting())}})}).on("mouseleave","#save",function(e){u.instancesKeep||(u.updateElements(),wp.customize.previewer.refresh())}),a("#save").on("click",function(e){u.instancesKeep=!0}),a(document).on("ajaxSend",function(e,t,o){void 0!==o.data&&-1!=o.data.indexOf("wp_customize=on")&&-1!=o.data.indexOf("action=customize_save")&&(u.customizeSave=!0)}),a(document).on("ajaxComplete",function(e,n){void 0!==n.responseText&&(u.customizeSave?(u.updateElements(!1),u.instancesKeep&&(u.instancesKeep=!1)):(0<=n.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")&&(u.action="customizerAjaxComplete",u.setControlInstances()),a.each(WPGlobusCustomize.controlWidgets,function(e,t){var o=e.replace("_","-");if(0<=n.responseText.indexOf(o))return t.submit.css({display:"block"}),t.control.liveUpdateMode=!1,a.each(t.element,function(e,t){a("#"+e).val(WPGlobusCore.TextFilter(t.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),t.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(t.control.setting().title,WPGlobusCustomize.languageAdmin)),u.widgetKeep=!1})),u.customizeSave=!1,wp.customize.previewer.refresh())})}};WPGlobusCustomize=a.extend({},WPGlobusCustomize,u),WPGlobusCustomize.init()});